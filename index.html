<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Auto Arena Survivor</title>
<style>
html,body{margin:0;height:100%;background:#0e1117;overflow:hidden;touch-action:none}
canvas{display:block;width:100vw;height:100vh}
.ui{
position:fixed;top:12px;left:12px;right:12px;
display:flex;justify-content:space-between;
font:800 13px system-ui;
color:#fff;
pointer-events:none;
}
.cardOverlay{
position:fixed;inset:0;
display:none;
align-items:center;
justify-content:center;
background:rgba(0,0,0,.6);
backdrop-filter:blur(6px);
}
.cardWrap{
display:flex;
gap:14px;
}
.card{
width:120px;
padding:14px;
border-radius:16px;
background:#1a1f29;
border:1px solid rgba(255,255,255,.08);
color:#fff;
font:700 12px system-ui;
text-align:center;
}
</style>
</head>
<body>

<div class="ui">
<div id="leftUI"></div>
<div id="rightUI"></div>
</div>

<div class="cardOverlay" id="upgradeOverlay">
<div class="cardWrap" id="cardWrap"></div>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

let DPR = Math.max(1, Math.min(3, window.devicePixelRatio||1));
let W=0,H=0;

function resize(){
DPR = Math.max(1, Math.min(3, window.devicePixelRatio||1));
W = window.innerWidth;
H = window.innerHeight;
canvas.width = W * DPR;
canvas.height = H * DPR;
canvas.style.width = W+"px";
canvas.style.height = H+"px";
ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener("resize",resize);
resize();

function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
function dist(ax,ay,bx,by){return Math.hypot(ax-bx,ay-by)}
function rand(a,b){return a+Math.random()*(b-a)}

let player={
x:W/2,
y:H/2,
r:14,
speed:210,
hp:100,
maxHp:100,
xp:0,
level:1,
damage:10,
fireRate:5,
lastShot:0
}

let bullets=[];
let enemies=[];
let expOrbs=[];

let wave=1;
let bossSpawned=false;

function spawnEnemy(boss=false){
let e={
x:rand(0,W),
y:rand(0,H),
r:boss?40:14,
hp:boss?600:40+wave*8,
speed:boss?60:80+wave*2,
boss:boss
}
enemies.push(e);
}

function spawnWave(){
for(let i=0;i<5+wave*2;i++)spawnEnemy();
}

spawnWave();

let joy={active:false,baseX:0,baseY:0,dx:0,dy:0}

canvas.addEventListener("pointerdown",e=>{
joy.active=true;
joy.baseX=e.clientX;
joy.baseY=e.clientY;
});

canvas.addEventListener("pointermove",e=>{
if(!joy.active)return;
joy.dx=e.clientX-joy.baseX;
joy.dy=e.clientY-joy.baseY;
});

canvas.addEventListener("pointerup",()=>joy.active=false);

function shoot(time){
if(time-player.lastShot < 1000/player.fireRate)return;
player.lastShot=time;
let nearest=null;
let nd=999999;
for(let e of enemies){
let d=dist(player.x,player.y,e.x,e.y);
if(d<nd){nd=d;nearest=e;}
}
if(!nearest)return;
let angle=Math.atan2(nearest.y-player.y,nearest.x-player.x);
bullets.push({
x:player.x,
y:player.y,
vx:Math.cos(angle)*520,
vy:Math.sin(angle)*520,
life:1.2
});
}

function levelUp(){
player.level++;
player.xp=0;
openUpgrade();
}

function openUpgrade(){
let overlay=document.getElementById("upgradeOverlay");
let wrap=document.getElementById("cardWrap");
wrap.innerHTML="";
overlay.style.display="flex";

let upgrades=[
{name:"Damage +5",apply:()=>player.damage+=5},
{name:"Attack Speed +1",apply:()=>player.fireRate+=1},
{name:"Max HP +20",apply:()=>{player.maxHp+=20;player.hp+=20}},
{name:"Move Speed +20",apply:()=>player.speed+=20}
];

upgrades.sort(()=>Math.random()-0.5);
let selected=upgrades.slice(0,3);

for(let u of selected){
let div=document.createElement("div");
div.className="card";
div.innerText=u.name;
div.onclick=()=>{
u.apply();
overlay.style.display="none";
}
wrap.appendChild(div);
}
}

function updateUI(){
document.getElementById("leftUI").innerText=
"HP "+player.hp+"/"+player.maxHp+
"\nLVL "+player.level+
"\nWAVE "+wave;

document.getElementById("rightUI").innerText=
"XP "+Math.floor(player.xp);
}

let last=performance.now();

function loop(now){
let dt=(now-last)/1000;
last=now;

if(joy.active){
let mag=Math.hypot(joy.dx,joy.dy);
if(mag>0){
player.x+=joy.dx/mag*player.speed*dt;
player.y+=joy.dy/mag*player.speed*dt;
}
}

player.x=clamp(player.x,0,W);
player.y=clamp(player.y,0,H);

shoot(now);

for(let i=bullets.length-1;i>=0;i--){
let b=bullets[i];
b.x+=b.vx*dt;
b.y+=b.vy*dt;
b.life-=dt;
if(b.life<=0)bullets.splice(i,1);
}

for(let i=enemies.length-1;i>=0;i--){
let e=enemies[i];
let angle=Math.atan2(player.y-e.y,player.x-e.x);
e.x+=Math.cos(angle)*e.speed*dt;
e.y+=Math.sin(angle)*e.speed*dt;

if(dist(e.x,e.y,player.x,player.y)<e.r+player.r){
player.hp-=20*dt;
if(player.hp<=0)location.reload();
}

for(let j=bullets.length-1;j>=0;j--){
let b=bullets[j];
if(dist(e.x,e.y,b.x,b.y)<e.r){
e.hp-=player.damage;
bullets.splice(j,1);
if(e.hp<=0){
player.xp+=20;
expOrbs.push({x:e.x,y:e.y});
enemies.splice(i,1);
break;
}
}
}
}

if(player.xp>=100){
levelUp();
}

if(enemies.length===0){
wave++;
if(wave%5===0&&!bossSpawned){
spawnEnemy(true);
bossSpawned=true;
}else{
spawnWave();
bossSpawned=false;
}
}

ctx.fillStyle="#0e1117";
ctx.fillRect(0,0,W,H);

ctx.strokeStyle="rgba(255,255,255,.05)";
for(let i=0;i<W;i+=60){
ctx.beginPath();
ctx.moveTo(i,0);
ctx.lineTo(i,H);
ctx.stroke();
}

for(let b of bullets){
ctx.fillStyle="#fff";
ctx.beginPath();
ctx.arc(b.x,b.y,4,0,Math.PI*2);
ctx.fill();
}

for(let e of enemies){
ctx.fillStyle=e.boss?"#ff4757":"#2ed573";
ctx.beginPath();
ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
ctx.fill();
}

ctx.fillStyle="#fff";
ctx.beginPath();
ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
ctx.fill();

updateUI();
requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>
